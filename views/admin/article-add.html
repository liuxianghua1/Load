<!DOCTYPE html>
<html class="x-admin-sm">

<head>
	<meta charset="UTF-8">
	<title>欢迎页面-X-admin2.2</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport"
		content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
	<link rel="stylesheet" href="/public/css/font.css">
	<link rel="stylesheet" href="/public/css/xadmin.css">
	<script type="text/javascript" src="/public/lib/layui/layui.js" charset="utf-8"></script>
	<script type="text/javascript" src="/public/js/xadmin.js"></script>

	

</head>

<body>
	<div class="layui-fluid">
		<div class="layui-row">
			<form class="layui-form" id="article_add">
				<div class="layui-form-item">
						<label for="username" class="layui-form-label">
							<span class="x-red">*</span>文章标题</label>
						<div class="layui-input-inline" style="width: 660px;margin-right: 0px;">
							<input type="text" placeholder="请输入标题" id="username" name="username" required="" lay-verify="required"
							 autocomplete="off" class="layui-input"></div>
					</div>

					<div class="layui-form-item layui-form-text">
						<label for="desc" class="layui-form-label">
							<span class="x-red">*</span>文章内容</label>
							
							<div class="layui-input-block">
									<textarea placeholder="请输入内容" id="desc" name="desc"required="" lay-verify="required" class="layui-textarea" style="height: 300px;"></textarea>
								</div>
					</div>
					<div class="layui-input-block">

				<input type="file" name="" id="file"  />
				<img id="picture" src="" alt="" style="width: 500px;height: 300px;"/>
				<br>
				<br>
				<br>
				<button onclick="doUpload()"class="layui-btn">确定上传</button>
				<br>

					</div>

				<div class="layui-form-item">
				<br>
				<br>
				<label for="L_repass" class="layui-form-label"></label>
					<button class="layui-btn"  lay-filter="add" lay-submit="" >发布</button></div>
			</form>
		</div>
	</div>
	<script src="/node_modules/jquery/dist/jquery.js"></script>
	<script>
		function doUpload(){
		var file = $('#file').get(0).files[0]
		let formdata = new FormData()
		formdata.append('hehe', file)
		console.log(file)
		$.ajax({
			url: '/upload',
			type: 'post',
			cache: false,
			data: formData,
			processData: false,
			contentType: false,
			success: function(data) {
				var err_code = data.err_code
				var url = `/public/uploads/${file.path}`
				console.log(url)
				if (err_code===0) {
					alert('上传成功')
					$('#picture').attr('src',`${data.img}`)
				} else if(err_code===-1){
					alert('尺寸过大')
				}else if(err_code===-2){
					alert('类型错误')
				}
			}
		})
		}
	</script>
	<script>
		layui.use(['form', 'layer'],
			function () {
				$ = layui.jquery;
				var form = layui.form,
					layer = layui.layer;

				
			});
	</script>
	<!-- <script>
				$('#article_add').on('submit', function (e) {
					e.preventDefault()
					var formData = $(this).serialize()
					$.ajax({
						url: '/upload',
						type: 'post',
						data: formData,
						dataType: 'json',
						success: function (data) {
							var err_code = data.err_code
							if (err_code === 0) {
								layer.alert("注册成功", {
									icon: 6
								},
									function () {
										//关闭当前frame
										xadmin.close();
		
										// 可以对父窗口进行刷新 
										xadmin.father_reload();
									});
							} else if (err_code === 1) {
								layer.alert('用户名或者手机号已存在！')
							} else if (err_code === 500) {
								layer.alert('服务器忙，请稍后重试！')
							}
						}
					})
				})
			</script> -->
</body>

</html>